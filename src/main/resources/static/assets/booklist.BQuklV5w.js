import{r as o,o as e,c as t,w as s,g as r,a,n as l,h as i,t as n,j as p,B as h,N as c,f as d,a3 as u,s as k,af as f,p as g,ag as m,q as y,e as C,v as b,x as w,F as x}from"./index-BPWBSeUu.js";import{_ as B}from"./uni-icons.JTGxvH_s.js";import{r as v}from"./uni-app.es.B1Bjb5HC.js";import{_ as I}from"./uni-badge.CqO5SaVO.js";import{_ as U}from"./uni-popup.DXps9OGM.js";import{_ as A}from"./_plugin-vue_export-helper.BCo6x5W8.js";const _=A({name:"booklist",props:["maxwidth","booklist","islist","iseditbook","safebottom","wrapperstyle"],components:{Bookinfo:A({data:()=>({show:!1,showBookInfo:{},bookCoverBgStyle:"",popupstyle:"",styleinfo:""}),methods:{closeinfo(){this.show=!1,this.$refs.popup.close()},CoverBgStyle(o){return this.getBookCoverUrl(o),""},showPopup(o,e){console.log(e.windowWidth),console.log(e.windowHeight);var t=e.windowWidth,s=e.windowHeight-e.statusBarHeight-e.safeAreaInsets.bottom;console.log(s),e.windowWidth>450&&(t=400,s>695&&(s=695)),this.styleinfo="max-height:"+(s-450)+"px",console.log(this.styleinfo),this.popupstyle=" width: 100%;height:100%;max-height:"+s+"px;max-width:"+t+"px",this.show=!0,this.showBookInfo=o,this.bookCoverBgStyle=this.CoverBgStyle(o),this.$refs.popup.open()},renderBookIntro:o=>(o.intro||"暂无简介").split("\n").map((o=>`${o.replace(/^\s+/g,"")}</p>`)).join(""),renderBookKind(o){if(!o)return"";return o.split(",").filter((o=>o)).map((o=>`<span style="margin-right: 5px">${o}</span>`)).join("")}}},[["render",function(u,k,f,g,m,y){const C=h,b=c,w=d,x=v(o("uni-popup"),U);return e(),t(x,{ref:"popup",style:{"z-index":"1001"},type:"center","background-color":"#fff"},{default:s((()=>[r(w,{style:l(m.popupstyle)},{default:s((()=>[r(b,{class:"title"},{default:s((()=>[a("书籍信息 "),r(C,{onClick:y.closeinfo,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAPdJREFUWEfNV0kSwjAMS37AocN3ge92OPADmKYTpqV2LBlDkksvtqR4i5tT55M786fxBJym83WJyuM+l2/U0XB3EShGz3QppDndokS0cHUBQSJ25ALmoQYsByYlCJZYhIijJQTFULsABZCEML7NNmSAqhDWx5wDDCBjWwWbAhZDBBixkdIFCbBEeMnXriSORFTc6/ByzA5KgBiJ7QUc05MWoIpwkNMpUFvNEXqqC7ZRPtTBP1PQtQhbrfbzNkQIEBvXIGKAGVuoCD2ArM+YzzF7i292grFWsoibf0bDwhxrLX8/NL1+TIjVIMzU9RyHsbMbUSRxxXoBvGQQMMpmzLUAAAAASUVORK5CYII=",style:{height:"20px",width:"20px","line-height":"24px",float:"right","margin-right":"15px"}},null,8,["onClick"])])),_:1}),r(w,{class:"book-info-container"},{default:s((()=>[r(w,{class:"book-cover"},{default:s((()=>[r(w,{class:"book-cover-bg",style:l(m.bookCoverBgStyle)},null,8,["style"]),r(w,{class:"book-cover-bg-image"},{default:s((()=>[m.showBookInfo.errorurl||""==u.getBookCoverUrl(m.showBookInfo)?i("",!0):(e(),t(C,{src:u.getBookCoverUrl(m.showBookInfo),key:m.showBookInfo.name,alt:"",onError:k[0]||(k[0]=o=>u.setDefaultImage(u.book)),style:{"max-height":"150px","max-width":"115px"}},null,8,["src"])),m.showBookInfo.errorurl||""==u.getBookCoverUrl(m.showBookInfo)?(e(),t(C,{key:m.showBookInfo.name,alt:"",style:{"max-height":"150px","max-width":"115px"},src:"/assets/error-DgErs-0_.jpeg"})):i("",!0)])),_:1})])),_:1}),r(w,{class:"book-name"},{default:s((()=>[a(n(m.showBookInfo.name),1)])),_:1}),r(w,{class:"book-kind",innerHTML:y.renderBookKind(m.showBookInfo.kind)},null,8,["innerHTML"]),r(w,{class:"book-props"},{default:s((()=>[r(w,{class:"book-prop book-author"},{default:s((()=>[a(" 作者： "+n(m.showBookInfo.author||"未知"),1)])),_:1}),r(w,{class:"book-prop book-origin"},{default:s((()=>[a(" 来源： "+n(u.displayOriginName(m.showBookInfo.origin)),1)])),_:1}),r(w,{class:"book-prop book-latest"},{default:s((()=>[p("span",{class:"latest-title"},"最新： "+n(m.showBookInfo.latestChapterTitle),1)])),_:1})])),_:1}),r(w,{class:"book-intro",style:l(m.styleinfo),innerHTML:y.renderBookIntro(m.showBookInfo)},null,8,["style","innerHTML"])])),_:1}),r(w,{style:{width:"100%",height:"20px"}})])),_:1},8,["style"])])),_:1},512)}],["__scopeId","data-v-9355e076"]])},emits:["scrollHandler","del"],methods:{scrollHandler(){this.$emit("scrollHandler")},showboolinfo(o){var e=this;u({success:function(t){e.$refs.bookinfoRef.showPopup(o,t)}})},delbook(o){console.log(o);var e=this;k({title:"提示",content:"此操作将删除书籍信息以及阅读进度, 是否继续?",confirmText:"确定",success:async t=>{t.confirm&&f(o).then((()=>{e.$emit("del")})).catch((o=>{g({title:o,icon:"error",duration:2e3})}))}})},toDetail(o){if(this.isLogin()){for(var e={name:o.name,bookUrl:o.bookUrl,index:o.durChapterIndex??0,type:o.type,coverUrl:this.getBookCoverUrl(o),tocUrl:o.tocUrl,author:o.author,origin:o.origin,originName:o.originName,latestChapterTitle:o.latestChapterTitle,durChapterPos:o.durChapterPos??0,intro:o.intro},t=null,s=this.$store.state.booklist,r=0;r<s.length;r++)e.bookUrl==s[r].bookUrl&&s[r].durChapterIndex&&(e.index=s[r].durChapterIndex),e.bookUrl!=s[r].bookUrl&&e.name==s[r].name&&e.author==s[r].author&&(t=s[r]);if(t){var a=this;k({title:"提示",content:"您在书架中已经含有这本书，是否进行换源",success:function(e){if(e.confirm)console.log("用户点击确定"),a.showLoading("加载中"),m(o.origin,t.bookUrl,o.bookUrl).then((o=>{a.hideLoading();var e={name:o.name,bookUrl:o.bookUrl,index:o.durChapterIndex??0,type:o.type,coverUrl:a.getBookCoverUrl(o),tocUrl:o.tocUrl,author:o.author,origin:o.origin,originName:o.originName,latestChapterTitle:o.latestChapterTitle,durChapterPos:o.durChapterPos??0,intro:o.intro,ishuanyuan:!0};a.$store.commit("setReadingBook",e),y({url:"/pages/reader/index",animationType:"pop-in",success:()=>{a.isandroid()&&plus.navigator.hideSystemNavigation()}})})).catch((o=>{a.hideLoading(),g({title:o,icon:"error",duration:2e3})}));else if(e.cancel){var s={name:t.name,bookUrl:t.bookUrl,index:t.durChapterIndex??0,type:t.type,coverUrl:a.getBookCoverUrl(o),tocUrl:t.tocUrl,author:t.author,origin:t.origin,originName:t.originName,latestChapterTitle:t.latestChapterTitle,durChapterPos:t.durChapterPos??0,intro:t.intro};a.$store.commit("setReadingBook",s),console.log("打开图书"),y({url:"/pages/reader/index",animationType:"pop-in",success:()=>{a.isandroid()&&plus.navigator.hideSystemNavigation()}})}}})}else this.$store.commit("setReadingBook",e),console.log("打开图书"),y({url:"/pages/reader/index",animationType:"pop-in",success:()=>{this.isandroid()&&plus.navigator.hideSystemNavigation()}})}else k({title:"提示",content:"您还未登陆, 是否登录?",confirmText:"登录",success:async o=>{o.confirm&&this.gotologin()}})},dateFormat(o){let e=(new Date).getTime(),t=parseInt((e-o)/1e3),s="";return s=t<=30?"刚刚":t<60?t+"秒前":t<3600?parseInt(t/60)+"分钟前":t<86400?parseInt(t/3600)+"小时前":t<2592e3?parseInt(t/86400)+"天前":t<31536e3?parseInt(t/2592e3)+"月前":parseInt(t/31536e3)+"年前",s}}},[["render",function(c,u,k,f,g,m){const y=h,U=d,A=v(o("uni-icons"),B),_=v(o("uni-badge"),I),T=C("bookinfo");return e(),t(U,{class:"shelf-wrapper"},{default:s((()=>[r(U,{class:"books-wrapper",ref:"bookList",style:l(k.wrapperstyle),onScroll:m.scrollHandler},{default:s((()=>[r(U,{class:"wrapper",style:l({"grid-template-columns":"repeat(auto-fill, "+k.maxwidth+"px)","margin-bottom":c.gettarbarheight()})},{default:s((()=>[(e(!0),b(x,null,w(k.booklist,(o=>(e(),t(U,{class:"book",key:o.bookUrl,style:l({width:k.maxwidth+"px"})},{default:s((()=>[r(U,{class:"cover-img"},{default:s((()=>[o.errorurl||""==c.getBookCoverUrl(o)?i("",!0):(e(),t(y,{key:0,class:"cover",onError:e=>c.setDefaultImage(o),onClick:e=>m.showboolinfo(o),src:c.getBookCoverUrl(o)},null,8,["onError","onClick","src"])),o.errorurl||""==c.getBookCoverUrl(o)?(e(),t(y,{key:1,class:"cover",onClick:e=>m.showboolinfo(o),src:"/assets/error-DgErs-0_.jpeg"},null,8,["onClick"])):i("",!0)])),_:2},1024),r(U,{class:"info"},{default:s((()=>[k.islist?(e(),t(U,{key:0,class:"book-operation"},{default:s((()=>[k.iseditbook?(e(),t(A,{key:0,type:"trash-filled",style:{display:"block"},onClick:e=>m.delbook(o),size:"24"},null,8,["onClick"])):i("",!0),k.iseditbook?i("",!0):(e(),t(_,{key:1,class:"uni-badge-left-margin",size:"normal",style:{display:"block",width:"32px","margin-right":"0px","margin-top":"0px"},text:o.totalChapterNum-1-o.durChapterIndex,"max-num":"99"},null,8,["text"]))])),_:2},1024)):i("",!0),r(U,{onClick:e=>m.toDetail(o),class:"name",slot:"reference"},{default:s((()=>[a(n(o.name),1)])),_:2},1032,["onClick"]),r(U,{onClick:e=>m.toDetail(o),class:"sub"},{default:s((()=>[r(U,{class:"author"},{default:s((()=>[p("p",{style:{"text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"}},n(o.author||""),1),o.totalChapterNum?i("",!0):(e(),b("p",{key:0,style:l([{width:k.maxwidth-110+"px"},{"text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"}])},n(o.intro||""),5))])),_:2},1024),o.totalChapterNum?(e(),t(U,{key:0,class:"dot"},{default:s((()=>[a("•")])),_:1})):i("",!0),o.totalChapterNum?(e(),t(U,{key:1,class:"size"},{default:s((()=>[a(" 共"+n(o.totalChapterNum)+"章 ",1)])),_:2},1024)):i("",!0)])),_:2},1032,["onClick"]),k.islist?(e(),t(U,{key:1,onClick:e=>m.toDetail(o),class:"dur-chapter"},{default:s((()=>[a(" 已读："+n(o.durChapterTitle?o.durChapterTitle:"啥也没读"),1)])),_:2},1032,["onClick"])):i("",!0),k.islist?i("",!0):(e(),t(U,{key:2,onClick:e=>m.toDetail(o),class:"dur-chapter"},{default:s((()=>[a(" 来源："+n(o.originName),1)])),_:2},1032,["onClick"])),o.latestChapterTitle&&k.islist?(e(),t(U,{key:3,onClick:e=>m.toDetail(o),class:"last-chapter"},{default:s((()=>[a(n(o.latestChapterTime?m.dateFormat(o.latestChapterTime):"最新")+"："+n(o.latestChapterTitle),1)])),_:2},1032,["onClick"])):i("",!0),o.latestChapterTitle&&!k.islist?(e(),t(U,{key:4,onClick:e=>m.toDetail(o),class:"last-chapter"},{default:s((()=>[a(" 最新："+n(o.latestChapterTitle),1)])),_:2},1032,["onClick"])):i("",!0),o.latestChapterTitle?i("",!0):(e(),t(U,{key:5,onClick:e=>m.toDetail(o),class:"last-chapter"},{default:s((()=>[a(n(o.kind),1)])),_:2},1032,["onClick"]))])),_:2},1024)])),_:2},1032,["style"])))),128))])),_:1},8,["style"]),r(U,{id:"end",style:l({height:k.safebottom+20+"px"})},null,8,["style"])])),_:1},8,["style","onScroll"]),r(T,{ref:"bookinfoRef"},null,512)])),_:1})}],["__scopeId","data-v-53840faa"]]);export{_ as b};
