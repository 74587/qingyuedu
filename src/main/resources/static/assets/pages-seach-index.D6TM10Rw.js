import{ac as o,ad as s,ae as i,e as t,c as e,w as h,f as a,o as l,g as r,n}from"./index-BPWBSeUu.js";import{n as c}from"./header.CpST7y72.js";import{b as d}from"./booklist.BQuklV5w.js";import{_ as g}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.JTGxvH_s.js";import"./uni-app.es.B1Bjb5HC.js";import"./uni-badge.CqO5SaVO.js";import"./uni-popup.DXps9OGM.js";const u=g({components:{booklist:d,navbar:c},data:()=>({url:"",page:1,bookSourceUrl:"",isover:!1,issearch:!1,isdo:!1,title:"",isok:!1,isqian:!1,booklist2:[],searchList:[]}),onLoad(){console.log("onLoad searchlist");var o=this.$store.state.seachoptions;""==o.url&&this.back(),this.title=o.title,o.issearch&&(console.log("搜素"),this.issearch=!0),this.searchList=this.$store.state.booksources,this.url=o.url,this.bookSourceUrl=o.bookSourceUrl,console.log(this.bookSourceUrl),console.log(this.url),this.isqian=!0,setTimeout((()=>{this.loadmore()}),500)},mounted(){this.isok=!0,this.getbookminmaxwidth(),this.bookonResize()},onShow:function(){console.log("searchlist Show"),this.isok&&(this.getbookminmaxwidth(),this.bookonResize()),this.isqian=!0},onHide:function(){console.log("searchlist Hide"),this.bookoffResize(),this.isqian=!1},onUnload(){this.hideLoading()},methods:{scrollHandler(){var s=this;o().in(this).select("#end").boundingClientRect((o=>{o.top-s.windowHeight<.1*s.windowHeight&&!s.isover&&s.isqian&&s.loadmore()})).exec()},loadmore(){this.isqian&&(console.log("loadmore"),this.issearch?this.search():this.exploreBook())},search(){if(!this.isover&&this.issearch&&!this.isdo){this.isdo=!0,this.showLoading("加载中"),console.log("search");var o=!1,i=this.bookSourceUrl,t=this.page;if(""==i&&(console.log("全部搜索"),console.log(this.searchList),o=!0,i=this.searchList[t-1].bookSourceUrl,this.searchList.length<=this.page))return console.log("搜索完了"),this.isover=!0,this.hideLoading(),void(this.isdo=!1);s(i,this.url,t).then((s=>{if(0==s.length)o||(this.isover=!0),this.isdo=!1;else{for(var i=this,t=0;t<s.length;t++)i.booklist.push(s[t]);setTimeout((function(){i.scrollHandler()}),1e3),i.page=this.page+1,i.isdo=!1}this.hideLoading()})).catch((o=>{console.log(o),this.hideLoading()}))}},exploreBook(){this.isover||this.issearch||this.isdo||(this.isdo=!0,this.showLoading("加载中"),console.log("exploreBook"),i(this.bookSourceUrl,this.url,this.page).then((o=>{if(0==o.length)this.isover=!0,this.isdo=!1;else{for(var s=this,i=0;i<o.length;i++)s.booklist.push(o[i]);setTimeout((function(){s.scrollHandler()}),1e3),s.page=this.page+1,s.isdo=!1}this.hideLoading()})).catch((o=>{console.log(o),this.hideLoading()})))}}},[["render",function(o,s,i,c,d,g){const u=a,p=t("navbar"),b=t("booklist");return l(),e(u,{class:"container",id:"book"},{default:h((()=>[r(u,{class:"status_bar",style:{background:"#F8F8F8"}}),r(p,{title:o.title,background:"#F8F8F8",ref:"headerref"},null,8,["title"]),r(b,{style:n({"max-height":o.windowHeight-o.safetopstyle-o.safebottom-46+"px",width:o.bookwindowWidth+"px"}),wrapperstyle:{"max-height":o.windowHeight-o.safetopstyle-o.safebottom-46+"px"},safebottom:o.safebottom,maxwidth:o.maxwidth,booklist:o.booklist,islist:!1,iseditbook:!1,onScrollHandler:o.scrollHandler},null,8,["style","wrapperstyle","safebottom","maxwidth","booklist","onScrollHandler"])])),_:1})}]]);export{u as default};
